
Start a Redis server in docker and run in background.

`docker run --name redis -d -p 6379:6379 redis redis-server`{{execute}}

Install python modules with pip.

`pip install redis`{{execute}}

Define the message queue publisher script.

<pre class="file" data-filename="queue_publisher.py" data-target="replace">
import redis
import time

r = redis.Redis(host='localhost', port=6379)
r.set('test', 'It is working!!!')

for i in range(1000):
    print(f"Generate order {i}")
    r.rpush('queue1',f"order {i}")
    time.sleep(1)
</pre>

Define the message queue processor script.

<pre class="file" data-filename="queue_processor.py" data-target="replace">
import redis
import time

r = redis.Redis(host='localhost', port=6379)
r.set('test', 'It is working!!!')

while True:
    result = r.lpop('queue1')
    print(result)
    if result is not None:
        s = result.decode("utf-8") 
        print(f"Processing: {s}")
        time.sleep(1)
        print("Done!")
    else:
        break
</pre>

We will now launch a publisher and two processors.

Open two more terminals T2, T3 and T4. 

First, start the publisher in Terminal 1.

`python3 queue_publisher.py`{{execute T1}}

Start processor 1 in T2.

`python3 queue_processor.py`{{execute T2}}

Start processor 2 in T2.

`python3 queue_processor.py`{{execute T2}}

Observe how the orders generated by the publisher are processed by the two processors.



Meanwhile, you may also execute redis-cli to check the keys in the Redis Server in T4

`docker exec -it redis redis-cli`{{execute T4}}



Stop the publisher/processor scripts with Ctrl+C (or Ctrl+Break).



Define the publisher script for a Publish-Subscribe channel.

<pre class="file" data-filename="pubsub_publisher.py" data-target="replace">
import redis
import time

r = redis.Redis(host='localhost', port=6379)
r.set('test', 'It is working!!!')

for i in range(1000):
    print(f"Generate order {i}")
    r.publish('channel1',f"order {i}")
    time.sleep(1)

</pre>

Define the processor script for a Publish-Subscribe channel.

<pre class="file" data-filename="pubsub_processor.py" data-target="replace">
import redis
import time

r = redis.Redis(host='localhost', port=6379)
r.set('test', 'It is working!!!')

pubsub=r.pubsub()
pubsub.subscribe(['channel1'])

for item in pubsub.listen():
    print(item)
    
    if item['type']=='message':
        data =item['data'].decode("utf-8") 
        print(f"processing: {data}")
        time.sleep(3)
        print(f"done: {data}")
  
</pre>


We will now launch a publisher and two processors.



Start processor 1 in T2.

`python3 pubsub_processor.py`{{execute T2}}

Start processor 2 in T3.

`python3 pubsub_processor.py`{{execute T3}}


Next, start the publisher in Terminal 1.

`python3 queue_publisher.py`{{execute T1}}


`python3 pubsub_publisher.py`{{execute}}


Observe how the orders generated by the publisher are processed by the two processors.

What is the difference between a messaging queue and publish-subscribe channel?


Meanwhile, you may also execute redis-cli to check the channel status in the Redis Server in T4



Stop the publisher/processor scripts with Ctrl+C (or Ctrl+Break).

