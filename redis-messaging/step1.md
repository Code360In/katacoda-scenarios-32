
Start a Redis server in docker and run in background.

`docker run --name redis -d -p 6379:6379 redis redis-server`{{execute}}

Install python modules with pip.

`pip install redis`{{execute}}

Define the message queue publisher script.

<pre class="file" data-filename="queue_publisher.py" data-target="replace">
import redis
import time

r = redis.Redis(host='localhost', port=6379)
r.set('test', 'It is working!!!')

for i in range(1000):
    print(f"Generate order {i}")
    r.rpush('queue1',f"order {i}")
    time.sleep(1)
</pre>

Define the message queue processor script.

<pre class="file" data-filename="queue_processor.py" data-target="replace">
import redis
import time

r = redis.Redis(host='localhost', port=6379)
r.set('test', 'It is working!!!')

while True:
    result = r.lpop('queue1')
    print(result)
    if result is not None:
        s = result.decode("utf-8") 
        print(f"Processing: {s}")
        time.sleep(1)
        print("Done!")
    else:
        break
</pre>

We will now launch a publisher and two processors.

Open two more terminals T2, T3 and T4. 

First, start the publisher in Terminal 1.

`python3 queue_publisher.py`{{execute T1}}

Start processor 1 in T2.

`python3 queue_processor.py`{{execute T2}}

Start processor 2 in T2.

`python3 queue_processor.py`{{execute T2}}

Observe how the orders generated by the publisher are processed by the two processors.



Meanwhile, you may also execute redis-cli to check the keys in the Redis Server in T4

`docker exec -it redis redis-cli`{{execute T4}}



Stop the publisher/processor scripts with Ctrl+C (or Ctrl+Break).

